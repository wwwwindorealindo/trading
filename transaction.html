<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaksi Keuangan - RaRock</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ======================================= */
        /* 1. VARIABEL & RESET DASAR */
        /* ======================================= */
        :root {
            --color-bg-light: #f5f7fa;    
            --color-card-bg: #ffffff;     
            --color-text-dark: #2d3748;   /* Warna utama nominal/teks: HITAM */
            --color-text-gray: #718096;   
            --color-accent-main: #00A3B0; 
            --color-success: #38A169;     
            --color-danger: #E53E3E;      
            --color-warning: #DD6B20;     
            --color-border-light: #c2c9d1; 
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease-out;
        }

        body {
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 450px;
            margin: 0 auto;
            padding: 0 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        /* ======================================= */
        /* 2. HEADER & TABS */
        /* ======================================= */
        .page-header {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 15px 0;
            position: sticky;
            top: 0;
            background-color: var(--color-bg-light);
            z-index: 10;
        }
        .page-header a {
            color: var(--color-text-dark);
            font-size: 20px;
            text-decoration: none;
            justify-self: start;
        }
        .page-header h2 {
            font-size: 18px;
            font-weight: 600;
            grid-column: 2 / 3;
            color: var(--color-text-dark);
        }

        .tabs-wrapper {
            background-color: var(--color-bg-light);
            padding: 10px 0;
            margin: 0 -20px; 
            padding: 10px 20px;
            border-bottom: 1px solid var(--color-border-light);
            position: sticky;
            top: 50px; 
            z-index: 9;
        }
        .tabs-nav {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            -ms-overflow-style: none; 
            scrollbar-width: none;    
        }
        .tabs-nav::-webkit-scrollbar {
            display: none; 
        }

        .tab-button {
            flex-shrink: 0; 
            padding: 8px 15px;
            border: 1px solid var(--color-border-light);
            border-radius: 20px;
            background-color: var(--color-card-bg);
            color: var(--color-text-gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .tab-button.active {
            background-color: var(--color-accent-main);
            color: var(--color-card-bg);
            border-color: var(--color-accent-main);
            box-shadow: 0 2px 5px rgba(0, 163, 176, 0.3);
        }

        /* ======================================= */
        /* 3. KONTEN DAFTAR & ITEM */
        /* ======================================= */
        .tab-content {
            padding: 15px 0;
            flex-grow: 1;
        }
        
        .transaction-list {
            display: none; 
            flex-direction: column;
            gap: 12px;
        }
        .transaction-list.active {
            display: flex; 
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--color-card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer; 
        }

        .item-details {
            text-align: left;
            flex-grow: 1;
        }
        .item-details .type {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .item-details .date {
            font-size: 12px;
            color: var(--color-text-gray);
        }

        .item-amount-wrapper {
            display: flex;
            align-items: center;
            gap: 10px; 
        }

        .item-amount {
            text-align: right;
        }
        .item-amount .amount {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        /* Warna nominal di daftar (tetap dipertahankan di daftar) */
        .amount.deposit, .amount.commission {
            color: var(--color-success);
        }
        .amount.withdrawal {
            color: var(--color-danger);
        }
        
        /* Ikon Panah Klik */
        .item-amount-wrapper .fas.fa-chevron-right {
            font-size: 14px;
            color: var(--color-text-gray);
        }
        
        /* Badge Status */
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-badge.success {
            background-color: #e6ffed; 
            color: var(--color-success);
        }
        .status-badge.pending {
            background-color: #fffbdd; 
            color: var(--color-warning);
        }
        .status-badge.failed {
            background-color: #ffeaea; 
            color: var(--color-danger);
        }
        .no-data {
            text-align: center;
            padding: 40px 0;
            color: var(--color-text-gray);
        }

        /* ======================================= */
        /* 4. MODAL/OVERLAY DETAIL */
        /* ======================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: var(--color-bg-light);
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: fadeInScale 0.3s ease-out;
        }
        
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--color-card-bg);
            border-bottom: 1px solid #eee;
        }
        .modal-header h3 {
            font-size: 18px;
            font-weight: 700;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--color-text-dark);
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto; 
            flex-grow: 1;
        }
        
        .summary-modal {
            background-color: var(--color-card-bg);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .summary-modal .icon-status {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .summary-modal .icon-status.success { color: var(--color-success); }
        .summary-modal .icon-status.pending { color: var(--color-warning); }
        .summary-modal .icon-status.failed { color: var(--color-danger); }
        
        /* Nominal di Modal: HITAM */
        .summary-modal h1 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--color-text-dark) !important; 
        }
        
        .summary-modal .status-text {
            font-size: 14px;
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 15px;
            display: inline-block;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--color-text-gray);
            font-weight: 500;
        }

        .detail-value {
            color: var(--color-text-dark) !important; /* Nominal detail: HITAM */
            font-weight: 600;
            max-width: 60%;
            text-align: right;
            word-wrap: break-word;
        }
        
    </style>
</head>
<body>
    <div class="container">
        
        <div class="page-header">
            <a href="dashboard.html" aria-label="Kembali"><i class="fas fa-arrow-left"></i></a>
            <h2>Riwayat Transaksi</h2>
            <div class="right-placeholder"></div>
        </div>

        <div class="tabs-wrapper">
            <div class="tabs-nav" id="tabs-nav">
                <button class="tab-button active" data-tab="all">Semua</button>
                <button class="tab-button" data-tab="commission">Komisi</button>
                <button class="tab-button" data-tab="deposit">Deposit</button>
                <button class="tab-button" data-tab="withdrawal">Penarikan</button>
            </div>
        </div>

        <div class="tab-content">
            <div class="transaction-list active" data-content="all"></div>
            <div class="transaction-list" data-content="commission"></div>
            <div class="transaction-list" data-content="deposit"></div>
            <div class="transaction-list" data-content="withdrawal"></div>
        </div>

    </div>

    <div class="modal-overlay" id="transactionDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detail Transaksi</h3>
                <button class="modal-close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                
                <div class="summary-modal" id="modalSummary">
                    </div>

                <div class="detail-card">
                    <div id="modalDetailList">
                        </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // =======================================
        // DATA TRANSAKSI LENGKAP
        // =======================================
        const transactionsData = [
            // DEPOSIT
            { id: 'TX-590234', type: 'deposit', description: 'Deposit Saldo via BCA', amount: 500000, date: '20 Nov 2025, 14:30', status: 'success', category: 'Deposit', notes: 'Dana masuk dari BCA V.A. Otomatis.', method: 'Virtual Account BCA' },
            { id: 'TX-2211AA', type: 'deposit', description: 'Pembayaran Deposit dari Aris', amount: 250000, date: '19 Nov 2025, 17:30', status: 'pending', category: 'Deposit', notes: 'Menunggu konfirmasi pembayaran transfer dari Aris.', method: 'Transfer Bank BRI' },
            { id: 'TX-33887C', type: 'deposit', description: 'Deposit Saldo via Dana', amount: 150000, date: '18 Nov 2025, 16:45', status: 'success', category: 'Deposit', notes: 'Top up berhasil dari E-wallet DANA.', method: 'E-Wallet DANA' },
            { id: 'TX-1100FF', type: 'deposit', description: 'Gagal Deposit (Waktu Habis)', amount: 100000, date: '19 Nov 2025, 11:00', status: 'failed', category: 'Deposit', notes: 'Batas waktu pembayaran telah habis. Silakan buat permintaan deposit baru.', method: 'QRIS' },
            
            // KOMISI
            { id: 'TX-12001A', type: 'commission', description: 'Komisi Afiliasi Level 1', amount: 125000, date: '20 Nov 2025, 12:15', status: 'success', category: 'Komisi', notes: 'Komisi dari referral level 1.', method: 'Sistem Otomatis' },
            { id: 'TX-44002D', type: 'commission', description: 'Komisi Afiliasi Level 2', amount: 50000, date: '18 Nov 2025, 10:00', status: 'success', category: 'Komisi', notes: 'Komisi dari referral level 2.', method: 'Sistem Otomatis' },
            
            // PENARIKAN
            { id: 'TX-77123B', type: 'withdrawal', description: 'Permintaan Penarikan ke Mandiri', amount: 200000, date: '19 Nov 2025, 09:00', status: 'pending', category: 'Penarikan', notes: 'Menunggu persetujuan tim keuangan.', method: 'Bank Mandiri (9876543210)' },
            { id: 'TX-60032S', type: 'withdrawal', description: 'Penarikan Dana Berhasil', amount: 300000, date: '18 Nov 2025, 15:00', status: 'success', category: 'Penarikan', notes: 'Dana telah ditransfer ke rekening BNI Anda.', method: 'Bank BNI (1122334455)' },
            { id: 'TX-99009E', type: 'withdrawal', description: 'Gagal Penarikan (Akun tidak aktif)', amount: 100000, date: '17 Nov 2025, 18:00', status: 'failed', category: 'Penarikan', notes: 'Rekening bank tujuan tidak aktif/salah. Silakan perbarui data rekening.', method: 'Bank BNI (1122334455)' },
        ];


        // =======================================
        // FUNGSI UTILITY & FORMATTING
        // =======================================

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        function getStatusInfo(status) {
            switch (status) {
                case 'success':
                    return { text: ' Berhasil', class: 'success' };
                case 'pending':
                    return { text: 'Diproses', class: 'pending' };
                case 'failed':
                    return { text: 'Gagal', class: 'failed' };
                default:
                    return { text: 'Status Tidak Diketahui', class: 'pending' };
            }
        }
        
        function getStatusIcon(status) {
            switch (status) {
                case 'success':
                    return { icon: 'fas fa-check-circle', class: 'success' };
                case 'pending':
                    return { icon: 'fas fa-clock', class: 'pending' };
                case 'failed':
                    return { icon: 'fas fa-times-circle', class: 'failed' };
                default:
                    return { icon: 'fas fa-info-circle', class: 'pending' };
            }
        }

        // =======================================
        // FUNGSI MODAL
        // =======================================
        const modal = document.getElementById('transactionDetailModal');
        const modalSummary = document.getElementById('modalSummary');
        const modalDetailList = document.getElementById('modalDetailList');

        function openModal(tx) {
            // Logika simulasi perhitungan
            if (tx.type === 'withdrawal') {
                // PENTING: Biaya Layanan 7%
                const feeRate = 0.07;
                tx.fee = Math.round(tx.amount * feeRate); // Hitung 7% dari jumlah penarikan
                tx.final_amount = tx.amount - tx.fee;
            } else {
                // Untuk deposit/komisi, biaya tetap 0
                tx.fee = 0;
                tx.final_amount = tx.amount;
            }

            renderModalSummary(tx);
            renderModalDetailList(tx);
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; 
        }

        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = ''; 
        }
        
        function renderModalSummary(tx) {
            const statusInfo = getStatusInfo(tx.status);
            const statusIcon = getStatusIcon(tx.status); 
            
            modalSummary.innerHTML = `
                <i class="${statusIcon.icon} icon-status ${statusIcon.class}"></i>
                <h1>${formatRupiah(tx.amount)}</h1>
                <span class="status-text ${statusInfo.class}">${statusInfo.text}</span>
            `;
        }

        function renderModalDetailList(tx) {
            modalDetailList.innerHTML = ''; 
            
            // Tentukan label biaya layanan
            const feeLabel = (tx.type === 'withdrawal') ? `Biaya Layanan 7%` : 'Biaya Layanan';
            
            const details = [
                { label: 'Jenis Transaksi', value: tx.category || tx.type.toUpperCase() },
                { label: 'ID Transaksi', value: tx.id },
                { label: 'Tanggal & Waktu', value: tx.date.replace(/,/, ' Pukul') },
                { label: 'Deskripsi', value: tx.description },
                { label: 'Metode', value: tx.method },
                { label: 'Jumlah Transaksi', value: formatRupiah(tx.amount) },
                // Biaya Layanan ditampilkan dalam nominal
                { label: feeLabel, value: tx.fee > 0 ? formatRupiah(tx.fee) : 'Gratis' },
                { label: 'Total Bersih', value: formatRupiah(tx.final_amount) }, 
            ];
            
            details.forEach(detail => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('detail-item');
                // Menghapus penggunaan detail.class
                itemDiv.innerHTML = `
                    <span class="detail-label">${detail.label}</span>
                    <span class="detail-value">${detail.value}</span>
                `;
                modalDetailList.appendChild(itemDiv);
            });
            // Bagian Catatan/Notes DIHAPUS
        }

        // Tutup modal jika user klik di luar area konten modal
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });


        // =======================================
        // FUNGSI UTAMA LIST
        // =======================================
        document.addEventListener('DOMContentLoaded', function() {
            const tabsNav = document.getElementById('tabs-nav');
            const tabButtons = tabsNav.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.transaction-list');
            
            
            function createTransactionItem(tx) {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('transaction-item');
                itemDiv.setAttribute('data-id', tx.id); 

                const amountClass = tx.type;
                const statusText = getStatusInfo(tx.status).text;
                const typeDisplay = tx.category || (tx.type.charAt(0).toUpperCase() + tx.type.slice(1));
                
                itemDiv.innerHTML = `
                    <div class="item-details">
                        <div class="type">${typeDisplay}</div>
                        <div class="date">${tx.date}</div>
                    </div>
                    <div class="item-amount-wrapper">
                        <div class="item-amount">
                            <div class="amount ${amountClass}">
                                ${formatRupiah(tx.amount)} 
                            </div>
                            <span class="status-badge ${tx.status}">${statusText}</span>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                `;
                return itemDiv;
            }

            function renderTransactions(filterType) {
                const targetContent = document.querySelector(`.transaction-list[data-content="${filterType}"]`);
                targetContent.innerHTML = ''; 

                const filteredData = (filterType === 'all')
                    ? transactionsData
                    : transactionsData.filter(tx => tx.type === filterType);
                
                // Sortir data berdasarkan tanggal terbaru
                filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));

                if (filteredData.length === 0) {
                    targetContent.innerHTML = `
                        <div class="no-data">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <p>Belum ada transaksi jenis ${filterType.charAt(0).toUpperCase() + filterType.slice(1)}.</p>
                        </div>
                    `;
                    return;
                }

                filteredData.forEach(tx => {
                    targetContent.appendChild(createTransactionItem(tx));
                });
            }
            
            function switchTab(targetTab) {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                const activeBtn = document.querySelector(`.tab-button[data-tab="${targetTab}"]`);
                if (activeBtn) activeBtn.classList.add('active');

                const activeContent = document.querySelector(`.transaction-list[data-content="${targetTab}"]`);
                if (activeContent) activeContent.classList.add('active');
                
                renderTransactions(targetTab);
            }

            tabsNav.addEventListener('click', function(e) {
                const targetButton = e.target.closest('.tab-button');
                if (targetButton) {
                    const targetTab = targetButton.getAttribute('data-tab');
                    switchTab(targetTab);
                }
            });
            
            // Event Listener KLIK ITEM (Membuka Modal)
            tabContents.forEach(content => {
                content.addEventListener('click', function(e) {
                    const item = e.target.closest('.transaction-item');
                    if (item) {
                        const transactionId = item.getAttribute('data-id');
                        const detail = transactionsData.find(tx => tx.id === transactionId);
                        
                        if (detail) {
                            openModal(detail); 
                        }
                    }
                });
            });

            switchTab('all'); 
        });
    </script>
</body>
</html>